<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- ğŸ”¥ KRITIKUS: Ne cache-elje a bÃ¶ngÃ©szÅ‘! -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <meta name="theme-color" content="#356dff" />
  <meta name="description" content="SzÃ¡mold ki, mennyi munkaÃ³rÃ¡dba kerÃ¼l egy vÃ¡sÃ¡rlÃ¡s!" />
  
  <title>Tivlo</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json" />
  
  <!-- ğŸ iOS PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Tivlo" />
  
  <!-- ğŸ Apple Touch Icons - KRITIKUS: 180x180px kÃ¼lÃ¶n fÃ¡jl! -->
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-192.png" />
  
  <!-- iOS Startup Image -->
  <link rel="apple-touch-startup-image" href="/icons/icon-512.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/icons/icon-192.png" />
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="/styles.css" />
  
  <!-- KRITIKUS: Version.js betÃ¶ltÃ©se ELÅSZÃ–R! -->
  <script src="/version.js"></script>
  
  <!-- ğŸ”¥ FORCE RELOAD handler -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'FORCE_RELOAD') {
          console.log('[HTML] Force reload message received');
          window.location.reload();
        }
      });
    }
  </script>
  
  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G8BZPSFGGG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-G8BZPSFGGG');
  </script>
</head>
<body>
  <!-- Update Available Banner -->
  <div id="update-banner" class="update-banner hidden">
    <span>ğŸ‰ Ãšj verziÃ³ elÃ©rhetÅ‘!</span>
    <button onclick="updateApp()" class="update-btn">FrissÃ­tÃ©s most</button>
  </div>

  <!-- Version Check Banner -->
  <div id="version-banner" class="version-banner hidden">
    <span>ğŸ‰ Ãšj verziÃ³ elÃ©rhetÅ‘!</span>
    <button onclick="reloadApp()" class="version-btn">FrissÃ­tÃ©s</button>
  </div>
  
  <div id="build-badge" style="position:fixed;left:8px;top:6px;font-size:11px;color:#5d6b85;opacity:.8;z-index:50;"></div>
  <script>
    // VerziÃ³ badge dinamikus beÃ¡llÃ­tÃ¡sa
    document.getElementById('build-badge').textContent = 'v' + APP_VERSION.split('.').slice(0,2).join('.') + ' PWA';
  </script>

  <!-- Share Widget -->
  <div id="shareWidget" class="share-widget">
    <div class="share-bubble" onclick="handleShare()">
      <button class="share-close" onclick="closeShareWidget(event)" aria-label="BezÃ¡rÃ¡s">Ã—</button>
      <div class="share-icon">ğŸš€</div>
      <div class="share-text">
        Oszd meg barÃ¡taiddal!
        <small>Kattints a megosztÃ¡shoz</small>
      </div>
    </div>
  </div>

  <div class="app-shell">
    <main class="screen-stack">

      <!-- 1. Welcome -->
      <section id="screen-welcome" class="screen active">
        <div class="welcome-hero">
          <div class="welcome-pill">ğŸ’° SzÃ¡molj Ã©s legyÃ©l szomorÃº!</div>
          <h1>Tivlo</h1>

          <div class="hero-clock" role="img" aria-label="Alarm clock">
            <div class="clock-body">
              <div class="clock-hand hour"></div>
              <div class="clock-hand minute"></div>
            </div>
            <div class="clock-bell left"></div>
            <div class="clock-bell right"></div>
            <div class="clock-leg left"></div>
            <div class="clock-leg right"></div>
          </div>

          <p class="welcome-copy">SzÃ¡mold ki, mennyi munkaÃ³rÃ¡dba kerÃ¼l egy vÃ¡gyott vÃ¡sÃ¡rlÃ¡s Ã©s Ã©rezd nagyon rosszul magad!</p>

          <!-- INVITE CARD -->
          <div id="inviteCard" class="card invite-card">
            <h3>ğŸ”‘ MeghÃ­vÃ³ szÃ¼ksÃ©ges</h3>
            <p class="invite-copy">Add meg az invite kÃ³dodat a TivloÃ©lmÃ©ny elÃ©rÃ©sÃ©hez.</p>
            <div class="invite-form">
              <input id="inviteCodeInput" placeholder="Pl. 1843-5092-JKLP" autocomplete="one-time-code" inputmode="text" />
              <button type="button" onclick="validateInvite()">âœ… KÃ³d ellenÅ‘rzÃ©se</button>
            </div>
            <div id="inviteStatus" class="invite-status" role="status" aria-live="polite"></div>
          </div>

          <!-- START CARD -->
          <div id="startCard" class="card hidden" style="width:100%;">
            <div class="stack">
              <button id="startButton" type="button" onclick="startApp()">ğŸš€ KezdjÃ¼k el!</button>
              <p style="text-align:center;font-size:0.85rem;">MÃ¡r <strong>2,847</strong> felhasznÃ¡lÃ³ spÃ³rolt <strong>18,392</strong> Ã³rÃ¡t! ğŸ‰</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. Profil -->
      <section id="screen-profile" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Tivlo</span>
            <h2>âš™ï¸ Profilod</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="TÃ©mÃ¡k vÃ¡ltÃ¡sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M12 12.75a5.25 5.25 0 1 0-5.25-5.25A5.26 5.26 0 0 0 12 12.75Zm0 2.25c-3.486 0-7.5 1.757-7.5 4.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5c0-2.743-4.014-4.5-7.5-4.5Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div class="card stack">
            <p>Add meg az alapadataidat, hogy pontosan lÃ¡ssuk, mennyi idÅ‘t dolgozol egy termÃ©kÃ©rt.</p>
            <input id="name" placeholder="ğŸ‘¤ NÃ©v" />
            <input id="age" placeholder="ğŸ‚ Ã‰letkor" type="number" />
            <input id="city" placeholder="ğŸ“ TelepÃ¼lÃ©s" />
            <input id="income" placeholder="ğŸ’° Havi nettÃ³ jÃ¶vedelem (Ft)" type="number" />
            <input id="hours" placeholder="â° Heti munkaÃ³ra" type="number" />
            <button onclick="saveProfile()">ğŸ’¾ MentÃ©s Ã©s tovÃ¡bblÃ©pÃ©s</button>
          </div>
        </div>
      </section>

      <!-- 3. KalkulÃ¡tor -->
      <section id="screen-calculator" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Tivlo</span>
            <h2>ğŸ§® KalkulÃ¡tor</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="TÃ©mÃ¡k vÃ¡ltÃ¡sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M6 2.75h12A3.25 3.25 0 0 1 21.25 6v12A3.25 3.25 0 0 1 18 21.25H6A3.25 3.25 0 0 1 2.75 18V6A3.25 3.25 0 0 1 6 2.75Zm.5 4a.75.75 0 0 0 0 1.5h2a.75.75 0 0 0 0-1.5h-2Zm0 4a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Zm0 4a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div class="card">
            <div class="stack">
              <input id="product" placeholder="ğŸ·ï¸ TermÃ©knÃ©v" />
              <input id="price" placeholder="ğŸ’µ Ãr (Ft)" type="number" />
              <button onclick="calculate()">ğŸ” SzÃ¡molÃ¡s</button>

              <div id="result-box" class="result-box">
                <div class="hours" id="hoursResult">0</div>
                <p style="font-size:1.1rem;font-weight:600;">munkaÃ³rÃ¡dba kerÃ¼lne</p>
                <div class="comparison" id="comparison"></div>
                <div class="decision-buttons">
                  <button class="save" onclick="saveDecision('megsporolom')">ğŸ’ª MegspÃ³rolom</button>
                  <button class="buy" onclick="saveDecision('megveszem')">ğŸ›’ Megveszem</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 4. ElÅ‘zmÃ©nyek -->
      <section id="screen-history" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Tivlo</span>
            <h2>ğŸ“œ ElÅ‘zmÃ©nyek</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="TÃ©mÃ¡k vÃ¡ltÃ¡sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M12 3.75A8.25 8.25 0 1 0 20.25 12a.75.75 0 0 1 1.5 0 9.75 9.75 0 1 1-3.31-7.324l1.155-1.154a.75.75 0 1 1 1.06 1.06l-2.5 2.5a.75.75 0 0 1-1.28-.53V4.5a.75.75 0 0 1 1.5 0v1.134A8.23 8.23 0 0 0 12 3.75Zm.75 4.5v3.44l2.845 1.705a.75.75 0 0 1-.76 1.29l-3.25-1.95A.75.75 0 0 1 11.25 12V8.25a.75.75 0 0 1 1.5 0Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div id="history-list"></div>
        </div>
      </section>

      <!-- 5. StatisztikÃ¡k -->
      <section id="screen-stats" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Tivlo</span>
            <h2>ğŸ“Š StatisztikÃ¡k</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="TÃ©mÃ¡k vÃ¡ltÃ¡sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M5.75 4A1.75 1.75 0 0 1 7.5 2.25h1A1.75 1.75 0 0 1 10.25 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5 5A1.75 1.75 0 0 1 13 7.25h1A1.75 1.75 0 0 1 15.75 9v10.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5-5A1.75 1.75 0 0 1 18.5 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2V4a1.75 1.75 0 0 1 1.75-1.75h1Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div class="quote-card">
            <div class="quote-icon">ğŸ’¡</div>
            <div class="quote-text" id="dailyQuote">Minden megspÃ³rolt Ã³ra egy lÃ©pÃ©s a pÃ©nzÃ¼gyi szabadsÃ¡g felÃ©!</div>
          </div>

          <div class="stats-grid">
            <div class="progress-shell">
              <div class="progress-ring" id="ratioCircle">
                <span id="ratio">0%</span>
              </div>
              <p style="font-weight:600;">SpÃ³rolÃ¡si arÃ¡ny ğŸ¯</p>
            </div>

            <div class="card">
              <h3>ğŸ“ˆ Heti Ã¶sszesÃ­tÅ‘</h3>
              <div class="chart-container">
                <div class="chart-bars" id="weeklyChart"></div>
              </div>
            </div>

            <div class="stats-cards">
              <div class="stats-card">
                <p>ğŸ’š <strong id="savedHours">0</strong> Ã³ra megspÃ³rolva</p>
              </div>
              <div class="stats-card">
                <p>ğŸ’¸ <strong id="spentHours">0</strong> Ã³ra elkÃ¶ltve</p>
              </div>
              <div class="stats-card">
                <p>ğŸ† <strong id="totalDecisions">0</strong> dÃ¶ntÃ©s eddig</p>
              </div>
              <div class="stats-card">
                <p>ğŸ”¥ <strong id="streak">0</strong> napos sorozat</p>
              </div>
            </div>

            <div class="card">
              <h3>ğŸ… EredmÃ©nyek</h3>
              <div class="achievements-grid" id="achievementsGrid"></div>
            </div>
          </div>

          <div class="card" style="text-align:center;">
            <button onclick="goTo('calculator')">ğŸ”™ Ãšj kalkulÃ¡ciÃ³</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <nav id="main-nav">
    <button id="nav-calculator" onclick="goTo('calculator')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M6.75 3A2.75 2.75 0 0 0 4 5.75v12.5A2.75 2.75 0 0 0 6.75 21h10.5A2.75 2.75 0 0 0 20 18.25V5.75A2.75 2.75 0 0 0 17.25 3Zm .75 3.5h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1 0-1.5Zm0 4h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1 0-1.5Zm0 4h4a.75.75 0 0 1 0 1.5h-4a.75.75 0 0 1 0-1.5Z"/></svg>
      <span>SzÃ¡mol</span>
    </button>
    <button id="nav-history" onclick="goTo('history')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M12 2.75A9.25 9.25 0 1 0 21.25 12a.75.75 0 0 1 1.5 0 10.75 10.75 0 1 1-3.694-8.076l1.288-1.288a.75.75 0 0 1 1.06 1.06l-2.75 2.75a.75.75 0 0 1-1.28-.53V4.5a.75.75 0 0 1 1.5 0v.792A9.23 9.23 0 0 0 12 2.75Zm.75 5.5v3.69l3.095 1.855a.75.75 0 0 1-.75 1.29l-3.5-2.1A.75.75 0 0 1 11.25 12V8.25a.75.75 0 0 1 1.5 0Z"/></svg>
      <span>TÃ¶rtÃ©net</span>
    </button>
    <button id="nav-stats" onclick="goTo('stats')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M6.75 4A1.75 1.75 0 0 1 8.5 2.25h1A1.75 1.75 0 0 1 11.25 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5 5A1.75 1.75 0 0 1 14 7.25h1A1.75 1.75 0 0 1 16.75 9v10.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5-5A1.75 1.75 0 0 1 19.5 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2V4a1.75 1.75 0 0 1 1.75-1.75h1Z"/></svg>
      <span>Statisztika</span>
    </button>
    <button id="nav-profile" onclick="goTo('profile')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M12 12.75a5.25 5.25 0 1 0-5.25-5.25A5.26 5.26 0 0 0 12 12.75Zm0 2.25c-3.486 0-7.5 1.757-7.5 4.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5c0-2.743-4.014-4.5-7.5-4.5Z"/></svg>
      <span>Profil</span>
    </button>
  </nav>

  <!-- JavaScript -->
  <script src="/app.js"></script>
</body>
</html>
