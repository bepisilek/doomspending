<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Munka√≥ra</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G8BZPSFGGG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-G8BZPSFGGG');
  </script>

  <style>
    /* ======================================================
       Vizu√°lis alapok
       ====================================================== */
    :root{
      --blue:#007aff;
      --blue-dark:#005fe0;
      --green:#22c55e;
      --red:#ef4444;
      --gray:#6b7280;
      --bg:#f7f9fb;
      --white:#ffffff;
      --shadow:0 8px 24px rgba(0,0,0,0.08);
      --radius:18px;
      --fast:.2s ease;
      --slow:.4s ease;
    }
    *{
      box-sizing:border-box;
      -webkit-tap-highlight-color:transparent;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      margin:0; padding:0;
    }
    html,body{height:100%;}
    body{
      background:var(--bg);
      color:#111;
      display:flex; flex-direction:column; align-items:center;
      min-height:100vh; overflow-x:hidden;
    }
    h1,h2,h3{font-weight:600;}
    h1{font-size:clamp(1.8rem,6vw,2.3rem);text-align:center;margin:0 0 1rem;}
    h2{font-size:1.4rem;margin:0 0 .8rem;}
    p{color:var(--gray);line-height:1.5;margin:0 0 1rem;}
    a{color:var(--blue);text-decoration:none;}
    a:hover{text-decoration:underline;}
    input,button{font-size:1rem;font-family:inherit;}

    /* ======================================================
       Inputok, gombok
       ====================================================== */
    input{
      width:100%; padding:.9rem 1rem; margin-bottom:.9rem;
      border:1px solid #e2e8f0; border-radius:var(--radius);
      background:var(--white);
      box-shadow:0 1px 3px rgba(0,0,0,0.04);
      transition:border var(--fast), box-shadow var(--fast);
    }
    input:focus{
      outline:none; border-color:var(--blue);
      box-shadow:0 0 0 3px rgba(0,122,255,.2);
    }
    button{
      width:100%; border:none; border-radius:var(--radius);
      background:var(--blue); color:var(--white);
      padding:1rem; font-weight:500;
      box-shadow:0 6px 15px rgba(0,122,255,.25);
      transition:background var(--fast), transform .1s;
      cursor:pointer;
    }
    button:hover{background:var(--blue-dark);}
    button:active{transform:scale(.97);}
    .btn-secondary{
      background:var(--white); color:var(--blue-dark);
      border:1px solid #d1d5db; box-shadow:none;
    }
    .btn-secondary:hover{background:#f1f5ff;}

    /* ======================================================
       K√©perny≈ëk √©s k√°rty√°k
       ====================================================== */
    .screen{
      display:none; width:100%; max-width:440px;
      padding:1.8rem 1.2rem 8rem;
      animation:fadeIn var(--slow);
    }
    .active{display:block;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(15px);}to{opacity:1;transform:translateY(0);}}
    .card{
      background:var(--white); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:1.6rem; margin:0 0 1.2rem;
    }

    /* Welcome lebeg≈ë ikon */
    .float-icon{
      width:120px; height:120px; border-radius:50%;
      background:var(--blue);
      box-shadow:0 15px 30px rgba(0,122,255,.25);
      margin:60px auto;
      animation:float 3s ease-in-out infinite;
    }
    @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

    /* Eredm√©ny doboz */
    .result-box{
      background:#e8f0fe; border:2px solid var(--blue);
      border-radius:var(--radius);
      text-align:center; padding:2rem 1rem; margin:1.5rem 0;
      box-shadow:0 5px 10px rgba(0,0,0,.05);
    }
    .result-box .hours{font-size:3.2rem; font-weight:700; color:var(--blue); margin:0 0 .3rem;}
    .decision-buttons{display:flex; gap:.8rem; justify-content:center; margin-top:1.2rem;}
    .decision-buttons button{width:50%; box-shadow:none;}
    .decision-buttons .save{background:var(--green);}
    .decision-buttons .buy{background:var(--red);}

    /* El≈ëzm√©nyek lista */
    .history-item{
      background:var(--white); border-left:6px solid; border-radius:var(--radius);
      margin:0 0 .8rem; padding:1rem 1.2rem;
      box-shadow:0 2px 5px rgba(0,0,0,.05);
      transition:transform .1s;
    }
    .history-item:hover{transform:scale(1.02);}
    .history-item.green{border-color:var(--green);}
    .history-item.red{border-color:var(--red);}
    .history-item strong{display:block; font-weight:600; margin:0 0 .2rem;}
    .history-item small{color:var(--gray); font-size:.8rem;}

    /* Statisztika dobozok */
    .stats-box{
      background:var(--white); border-radius:var(--radius);
      padding:1.6rem; text-align:center; box-shadow:var(--shadow);
      margin:0 0 1.2rem;
    }
    .stats-box .big{font-size:2.5rem; color:var(--blue); font-weight:700; margin:0 0 .4rem;}

    /* Lebeg≈ë als√≥ men√º */
    nav{
      position:fixed; left:50%; bottom:25px; transform:translateX(-50%);
      background:rgba(255,255,255,.85); backdrop-filter:blur(10px);
      box-shadow:0 4px 20px rgba(0,0,0,.12);
      border-radius:30px;
      width:85%; max-width:380px; height:62px;
      display:flex; justify-content:space-around; align-items:center;
      z-index:20; transition:all var(--slow);
    }
    nav button{
      background:none; border:none; color:var(--gray);
      font-size:1.4rem; flex:1; height:100%;
      border-radius:30px; transition:color var(--fast), background var(--fast);
    }
    nav button.active{
      color:var(--blue); background:rgba(0,122,255,.12);
    }
    @media(min-width:768px){
      .screen{padding-bottom:10rem;}
      nav{bottom:40px;}
    }
  </style>
</head>
<body>

  <!-- 1. Welcome -->
  <div id="screen-welcome" class="screen active">
    <h1>Munka√≥ra</h1>
    <p style="text-align:center;">L√°ssuk, h√°ny √≥r√°t dolgozol egy-egy v√°s√°rl√°s√©rt</p>
    <div class="float-icon"></div>
    <div class="card" style="text-align:center;">
      <button onclick="goTo('profile'); track('start_click')">Kezdj√ºk</button>
    </div>
  </div>

  <!-- 2. Profil -->
  <div id="screen-profile" class="screen">
    <h2>Profilod</h2>
    <div class="card">
      <p>Add meg egyszer az alapadataidat</p>
      <input id="name" placeholder="N√©v" />
      <input id="age" placeholder="√âletkor" type="number" />
      <input id="city" placeholder="Telep√ºl√©s" />
      <input id="income" placeholder="Havi nett√≥ j√∂vedelem (Ft)" type="number" />
      <input id="hours" placeholder="Heti munka√≥ra" type="number" />
      <button onclick="saveProfile()">Ment√©s √©s tov√°bbl√©p√©s</button>
    </div>
  </div>

  <!-- 3. Kalkul√°tor -->
  <div id="screen-calculator" class="screen">
    <h2>Kalkul√°tor</h2>
    <div class="card">
      <p>√çrd be a term√©ket √©s az √°r√°t</p>
      <input id="product" placeholder="Term√©kn√©v" />
      <input id="price" placeholder="√År (Ft)" type="number" />
      <button onclick="calculate()">N√©zz√ºk</button>

      <div id="result-box" class="result-box" style="display:none;">
        <div class="hours" id="hoursResult">0</div>
        <p>munka√≥r√°dba ker√ºlne</p>
        <div class="decision-buttons">
          <button class="save" onclick="saveDecision('megsporolom')">Megsp√≥rolom</button>
          <button class="buy" onclick="saveDecision('megveszem')">Megveszem</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 4. El≈ëzm√©nyek -->
  <div id="screen-history" class="screen">
    <h2>El≈ëzm√©nyek</h2>
    <div id="history-list"></div>
  </div>

  <!-- 5. Statisztik√°k -->
  <div id="screen-stats" class="screen">
    <h2>Statisztik√°k</h2>
    <div class="stats-box">
      <div class="big" id="ratio">0%</div>
      <p>Sp√≥rol√°si ar√°ny</p>
    </div>
    <div class="stats-box">
      <p><strong id="savedHours">0</strong> √≥ra megsp√≥rolva</p>
      <p><strong id="spentHours">0</strong> √≥ra elk√∂ltve</p>
    </div>
    <div class="card" style="text-align:center;">
      <button onclick="goTo('calculator')">√öj kalkul√°ci√≥</button>
    </div>
  </div>

  <!-- Lebeg≈ë men√º -->
  <nav>
    <button id="nav-calculator" class="active" onclick="goTo('calculator')" aria-label="Kalkul√°tor">üßÆ</button>
    <button id="nav-history" onclick="goTo('history')" aria-label="El≈ëzm√©nyek">üìú</button>
    <button id="nav-stats" onclick="goTo('stats')" aria-label="Statisztik√°k">üìä</button>
  </nav>

  <script>
    /* ======================================================
       GA esem√©nyk√ºld√©s
       ====================================================== */
    function track(name, params = {}) {
      if (window.gtag) window.gtag('event', name, params);
    }

    /* ======================================================
       Navig√°ci√≥
       ====================================================== */
    function goTo(screen) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(`screen-${screen}`).classList.add('active');

      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      const nb = document.getElementById(`nav-${screen}`);
      if (nb) nb.classList.add('active');

      track('view_' + screen);

      if (screen === 'history') loadHistory();
      if (screen === 'stats') loadStats();
    }

    /* ======================================================
       T√°rol√°s
       ====================================================== */
    const STORE_KEY = 'munkaora_data';
    function loadData(){
      try{
        return JSON.parse(localStorage.getItem(STORE_KEY)) || { profile:{}, history:[] };
      }catch(e){
        return { profile:{}, history:[] };
      }
    }
    function saveData(data){ localStorage.setItem(STORE_KEY, JSON.stringify(data)); }

    /* ======================================================
       Profil ment√©s
       ====================================================== */
    function saveProfile(){
      const data = loadData();
      data.profile = {
        name: document.getElementById('name').value,
        age: +document.getElementById('age').value,
        city: document.getElementById('city').value,
        income: +document.getElementById('income').value,
        hoursPerWeek: +document.getElementById('hours').value
      };
      saveData(data);
      track('profile_saved');
      goTo('calculator');
    }

    /* ======================================================
       Kalkul√°ci√≥
       ====================================================== */
    let currentProduct = null;
    let currentPrice = 0;
    let currentHours = 0;

    function calculate(){
      const data = loadData();
      const p = data.profile;

      if(!p.income || !p.hoursPerWeek){
        alert('El≈ëbb add meg a profilod adatait!');
        goTo('profile');
        return;
      }

      const product = document.getElementById('product').value.trim();
      const price = +document.getElementById('price').value;

      if(!product || !price){
        alert('Add meg a term√©k nev√©t √©s √°r√°t!');
        return;
      }

      const hourly = p.income / (p.hoursPerWeek * 4); // havi nett√≥ / havi munka√≥r√°k
      const hours = (price / hourly).toFixed(1);

      document.getElementById('result-box').style.display = 'block';
      document.getElementById('hoursResult').innerText = hours;

      currentProduct = product;
      currentPrice = price;
      currentHours = hours;

      track('calculation_done', { product, price });
    }

    /* ======================================================
       D√∂nt√©s ment√©s
       ====================================================== */
    function saveDecision(type){
      if(!currentProduct){ alert('El≈ëbb sz√°moljunk!'); return; }

      const data = loadData();
      data.history.push({
        id: Date.now(),
        product: currentProduct,
        price: currentPrice,
        hours: currentHours,
        decision: type,
        ts: new Date().toISOString()
      });
      saveData(data);

      track('decision_click', { decision: type, product: currentProduct, price: currentPrice });

      // UI reset
      document.getElementById('result-box').style.display = 'none';
      document.getElementById('product').value = '';
      document.getElementById('price').value = '';

      goTo('history');
    }

    /* ======================================================
       El≈ëzm√©nyek bet√∂lt√©se
       ====================================================== */
    function loadHistory(){
      const list = document.getElementById('history-list');
      list.innerHTML = '';
      const data = loadData();

      if(data.history.length === 0){
        list.innerHTML = '<div class="card" style="text-align:center;"><p>M√©g nincs adatod.</p><button class="btn-secondary" onclick="goTo(\'calculator\')">Ind√≠ts kalkul√°ci√≥t</button></div>';
        track('history_empty_view');
        return;
      }

      [...data.history].reverse().forEach(item=>{
        const el = document.createElement('div');
        el.className = 'history-item ' + (item.decision === 'megsporolom' ? 'green' : 'red');
        el.innerHTML =
          '<strong>' + escapeHtml(item.product) + '</strong>' +
          '<span>' + Number(item.price).toLocaleString('hu-HU') + ' Ft</span><br>' +
          '<small>' + item.hours + ' √≥ra ‚Ä¢ ' + new Date(item.ts).toLocaleDateString('hu-HU') + '</small>';
        list.appendChild(el);
      });
      track('history_loaded', { count: data.history.length });
    }

    /* ======================================================
       Statisztik√°k
       ====================================================== */
    function loadStats(){
      const data = loadData();
      const saved = data.history.filter(i => i.decision === 'megsporolom');
      const spent = data.history.filter(i => i.decision === 'megveszem');

      const total = data.history.length;
      const ratio = total ? Math.round((saved.length / total) * 100) : 0;

      document.getElementById('ratio').innerText = ratio + '%';

      const savedHours = saved.reduce((sum,i)=> sum + Number(i.hours), 0);
      const spentHours = spent.reduce((sum,i)=> sum + Number(i.hours), 0);

      document.getElementById('savedHours').innerText = savedHours.toFixed(1);
      document.getElementById('spentHours').innerText = spentHours.toFixed(1);

      track('stats_loaded', { total, ratio, savedHours, spentHours });
    }

    /* ======================================================
       Init, helper
       ====================================================== */
    (function init(){
      // Profil adatok visszat√∂lt√©se
      const d = loadData();
      if(d.profile){
        document.getElementById('name').value = d.profile.name || '';
        document.getElementById('age').value = d.profile.age || '';
        document.getElementById('city').value = d.profile.city || '';
        document.getElementById('income').value = d.profile.income || '';
        document.getElementById('hours').value = d.profile.hoursPerWeek || '';
      }
    })();

    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }
  </script>
</body>
</html>
