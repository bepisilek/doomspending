<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Munka√≥ra ‚Ä¢ Pro</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G8BZPSFGGG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-G8BZPSFGGG');
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

    :root{
      --blue-500:#356dff;
      --blue-600:#2b5bf7;
      --blue-700:#1c45d9;
      --cyan:#37d4ff;
      --teal:#28d3c0;
      --green:#31d69f;
      --red:#ff5c6a;
      --orange:#ff9c4a;
      --purple:#b968ff;
      --text:#0f172a;
      --muted:#5d6b85;
      --white:#ffffff;
      --glass:rgba(255,255,255,0.78);
      --glass-strong:rgba(255,255,255,0.92);
      --glass-border:rgba(255,255,255,0.55);
      --shadow-soft:0 25px 60px -35px rgba(15,27,60,0.65);
      --shadow-hero:0 40px 80px -40px rgba(33,88,255,0.55);
      --shadow-nav:0 26px 60px -30px rgba(18,36,78,0.50);
      --radius-2xl:34px;
      --radius-xl:28px;
      --radius-lg:22px;
      --radius-md:18px;
      --radius-sm:14px;
      --fast:.25s cubic-bezier(.3,.7,.4,1);
      --slow:.6s cubic-bezier(.16,1,.3,1);
    }

    [data-theme="dark"]{
      --text:#e2e8f0;
      --muted:#94a3b8;
      --glass:rgba(15,23,42,0.75);
      --glass-strong:rgba(15,23,42,0.88);
      --glass-border:rgba(71,85,105,0.35);
    }
    [data-theme="dark"] body{
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(53,109,255,0.15), rgba(0,0,0,0) 60%),
        radial-gradient(900px 900px at -10% 110%, rgba(30,70,160,0.18), rgba(0,0,0,0) 60%),
        linear-gradient(180deg,#0f172a 0%, #1e293b 100%);
    }

    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
    html,body{height:100%;}
    body{
      font-family:Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(120,216,255,0.25), rgba(255,255,255,0) 60%),
        radial-gradient(900px 900px at -10% 110%, rgba(53,109,255,0.20), rgba(255,255,255,0) 60%),
        linear-gradient(180deg,#eef3ff 0%, #f9fbff 100%);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:stretch;
      overflow-x:hidden;
      position:relative;
      transition:background 0.4s ease;
    }

    body::before, body::after{
      content:"";
      position:fixed;
      pointer-events:none;
      filter:blur(120px);
      opacity:0.65;
      z-index:0;
      transition:opacity 0.4s ease;
    }
    body::before{
      width:540px; height:540px; top:-180px; right:-130px;
      background:radial-gradient(circle at center, rgba(81,167,255,0.6), rgba(255,255,255,0));
    }
    body::after{
      width:560px; height:560px; bottom:-220px; left:-160px;
      background:radial-gradient(circle at center, rgba(143,219,255,0.55), rgba(255,255,255,0));
    }

    .app-shell{
      width:min(100%,480px);
      min-height:100vh;
      padding:clamp(24px,6vw,44px) clamp(18px,6vw,32px) 280px;
      position:relative;
      z-index:1;
      display:flex;
    }
    .screen-stack{flex:1; display:flex; position:relative;}
    .screen{
      display:none;
      width:100%;
      position:relative;
      animation:fadeSlide var(--slow);
    }
    .screen.active{display:block;}

    @keyframes fadeSlide{
      from{opacity:0; transform:translateY(18px);}
      to{opacity:1; transform:translateY(0);}
    }

    .screen::before{
      content:"";
      position:absolute; inset:0; z-index:-1;
      border-radius:var(--radius-2xl);
      background:radial-gradient(120% 120% at 50% 0%, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0.15) 65%, rgba(255,255,255,0) 100%);
      opacity:0.75;
      pointer-events:none;
    }

    h1{font-size:clamp(2.2rem,8vw,2.7rem); font-weight:800; letter-spacing:-.01em; text-align:center;}
    h2{font-size:1.5rem; font-weight:700;}
    h3{font-size:1.15rem; font-weight:700; margin-bottom:12px;}
    p{color:var(--muted); line-height:1.6;}
    .caption{font-size:.72rem; text-transform:uppercase; letter-spacing:.18em; color:var(--muted);}

    .hidden{
      display:none !important;
    }

    /* Version Banner */
    .version-banner{
      position:fixed;
      top:0;
      left:50%;
      transform:translateX(-50%);
      background:linear-gradient(135deg, #31d69f 0%, #28d3c0 100%);
      color:#fff;
      padding:12px 20px;
      border-radius:0 0 16px 16px;
      box-shadow:0 8px 24px rgba(49,214,159,0.4);
      z-index:100;
      display:flex;
      align-items:center;
      gap:12px;
      font-size:0.9rem;
      font-weight:600;
      animation:slideDown 0.4s ease;
    }
    @keyframes slideDown{
      from{ transform:translateX(-50%) translateY(-100%); opacity:0; }
      to{ transform:translateX(-50%) translateY(0); opacity:1; }
    }
    .version-btn{
      padding:6px 16px;
      font-size:0.85rem;
      background:rgba(255,255,255,0.25);
      border:1px solid rgba(255,255,255,0.4);
      color:#fff;
      border-radius:8px;
      cursor:pointer;
      transition:all var(--fast);
      font-weight:700;
    }
    .version-btn:hover{
      background:rgba(255,255,255,0.35);
      transform:scale(1.05);
    }

    .screen-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:18px 22px; margin-bottom:18px;
      border-radius:var(--radius-xl);
      background:var(--glass);
      backdrop-filter:blur(24px);
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow-soft);
      position:relative;
    }
    .header-icon{
      width:46px; height:46px; border-radius:18px;
      background:linear-gradient(135deg, rgba(49,115,255,0.92), rgba(120,216,255,0.65));
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 16px 32px -18px rgba(26,92,255,0.7);
    }
    .header-icon svg{width:22px; height:22px; fill:#fff;}

    .theme-toggle{
      position:absolute;
      top:50%;
      right:80px;
      transform:translateY(-50%);
      width:44px;
      height:44px;
      border-radius:12px;
      background:rgba(255,255,255,0.5);
      border:1px solid rgba(200,215,255,0.5);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:all var(--fast);
    }
    .theme-toggle:hover{
      transform:translateY(-50%) scale(1.05);
      background:rgba(255,255,255,0.75);
    }
    .theme-toggle svg{
      width:20px;
      height:20px;
      fill:var(--blue-600);
    }

    .welcome-hero{
      margin-top:24px;
      display:flex; flex-direction:column; align-items:center; gap:26px;
      text-align:center;
    }
    .welcome-pill{
      padding:10px 18px; border-radius:999px;
      background:rgba(255,255,255,0.65); border:1px solid rgba(255,255,255,0.6);
      color:var(--muted); font-size:.82rem;
      backdrop-filter:blur(20px);
      box-shadow:0 10px 28px -22px rgba(15,27,60,0.8);
    }
    .welcome-copy{max-width:340px; font-size:1rem;}

    .hero-clock{
      width:220px; height:220px; position:relative; border-radius:50%;
      display:grid; place-items:center;
      background:
        radial-gradient(circle at 50% 38%, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.8) 35%, rgba(245,250,255,0.55) 60%, rgba(35,123,255,0.20) 100%);
      box-shadow:
        0 22px 60px -32px rgba(25,78,255,0.55),
        inset 0 14px 36px rgba(255,255,255,0.9),
        inset 0 -12px 28px rgba(120,180,255,0.25);
      overflow:visible;
      animation:floatClock 5s ease-in-out infinite;
      isolation:isolate;
    }
    .hero-clock::before{
      content:"";
      position:absolute; inset:10px; border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,1) 0%, rgba(255,255,255,0.8) 60%, rgba(240,246,255,0.8) 62%, rgba(230,238,255,0.45) 65%, rgba(255,255,255,0) 70%);
      box-shadow:
        inset 0 0 0 1px rgba(180,205,255,0.55),
        inset 0 6px 18px rgba(255,255,255,0.9),
        0 24px 54px -34px rgba(40,88,210,0.55);
      pointer-events:none;
    }
    .hero-clock::after{
      content:"";
      position:absolute; width:70%; height:16px; bottom:-20px; left:15%;
      background:radial-gradient(ellipse at center, rgba(30,50,105,0.28), rgba(30,50,105,0) 70%);
      filter:blur(10px);
      opacity:.65;
      z-index:-1;
    }

    .clock-body{
      position:relative; width:72%; height:72%; border-radius:50%;
      background:
        radial-gradient(circle at 50% 45%, rgba(255,255,255,0.95) 0%, rgba(245,250,255,0.85) 50%, rgba(200,220,255,0.60) 80%, rgba(180,210,255,0.45) 100%);
      box-shadow:
        inset 0 0 0 1px rgba(210,222,255,0.55),
        inset 0 20px 50px rgba(255,255,255,0.9);
      display:grid; place-items:center;
    }

    .clock-body::before{
      content:"";
      position:absolute; inset:10%; border-radius:50%;
      background:
        conic-gradient(from -90deg,
          rgba(103,140,225,0.35) 0.5deg, transparent 1deg,
          transparent 29deg, rgba(103,140,225,0.35) 30deg,
          transparent 31deg, transparent 59deg, rgba(103,140,225,0.35) 60deg,
          transparent 61deg, transparent 89deg, rgba(103,140,225,0.35) 90deg,
          transparent 91deg, transparent 119deg, rgba(103,140,225,0.35) 120deg,
          transparent 121deg, transparent 149deg, rgba(103,140,225,0.35) 150deg,
          transparent 151deg, transparent 179deg, rgba(103,140,225,0.35) 180deg,
          transparent 181deg, transparent 209deg, rgba(103,140,225,0.35) 210deg,
          transparent 211deg, transparent 239deg, rgba(103,140,225,0.35) 240deg,
          transparent 241deg, transparent 269deg, rgba(103,140,225,0.35) 270deg,
          transparent 271deg, transparent 299deg, rgba(103,140,225,0.35) 300deg,
          transparent 301deg, transparent 329deg, rgba(103,140,225,0.35) 330deg,
          transparent 331deg
        );
      filter:blur(.2px);
    }

    .clock-hand{
      position:absolute; bottom:50%; left:50%;
      transform-origin:bottom center;
      background:linear-gradient(180deg, rgba(53,109,255,0.9), rgba(120,216,255,0.9));
      border-radius:999px;
      box-shadow:0 6px 16px -8px rgba(33,88,255,0.65);
    }
    .clock-hand.hour{ width:6px; height:34%; transform:translate(-50%, 0) rotate(0deg); animation:tickHour 720s linear infinite; }
    .clock-hand.minute{ width:4px; height:46%; transform:translate(-50%, 0) rotate(0deg); animation:tickMinute 60s linear infinite; }

    .clock-bell{
      position:absolute; top:-22px; width:54px; height:28px; border-radius:999px 999px 16px 16px/999px 999px 16px 16px;
      background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(205,220,255,0.9));
      box-shadow:
        0 10px 20px -12px rgba(25,70,180,0.55),
        inset 0 4px 10px rgba(255,255,255,0.9);
    }
    .clock-bell.left{ left:28px; transform:rotate(-8deg); }
    .clock-bell.right{ right:28px; transform:rotate(8deg); }

    .clock-leg{
      position:absolute; bottom:-6px; width:20px; height:8px; border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(210,225,255,0.9));
      box-shadow:0 8px 18px -10px rgba(25,60,140,0.5);
    }
    .clock-leg.left{ left:46px; transform:rotate(-8deg); }
    .clock-leg.right{ right:46px; transform:rotate(8deg); }

    @keyframes floatClock{
      0%,100%{ transform:translateY(0) }
      50%{ transform:translateY(-12px) }
    }
    @keyframes tickMinute{ from{ transform:translate(-50%, 0) rotate(0deg); } to{ transform:translate(-50%, 0) rotate(360deg); } }
    @keyframes tickHour{ from{ transform:translate(-50%, 0) rotate(0deg); } to{ transform:translate(-50%, 0) rotate(360deg); } }

    .card{
      background:var(--glass-strong);
      backdrop-filter:blur(26px);
      border-radius:var(--radius-xl);
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow-soft);
      padding:24px;
    }
    .stack{display:flex; flex-direction:column; gap:18px;}

    .invite-card{ display:flex; flex-direction:column; gap:16px; align-items:stretch; text-align:left; }
    .invite-card h3{ text-align:left; margin-bottom:4px; }
    .invite-copy{ font-size:0.9rem; color:var(--muted); text-align:left; }
    .invite-form{ display:flex; flex-direction:column; gap:12px; }
    .invite-form button{ width:100%; }
    @media(min-width:520px){
      .invite-form{ flex-direction:row; align-items:center; }
      .invite-form input{ flex:1; }
      .invite-form button{ width:auto; padding-inline:28px; }
    }
    .invite-status{ min-height:1.4em; font-size:0.88rem; font-weight:600; color:var(--muted); }
    .invite-status[data-status="success"]{ color:var(--green); }
    .invite-status[data-status="error"]{ color:var(--red); }
    .invite-status[data-status="info"]{ color:var(--blue-600); }

    input, select{
      width:100%;
      border-radius:var(--radius-md);
      border:1px solid rgba(202,213,255,0.45);
      padding:14px 18px;
      background:rgba(255,255,255,0.55);
      backdrop-filter:blur(10px);
      font-size:1rem; font-weight:500; color:var(--text);
      transition:border var(--fast), box-shadow var(--fast), transform var(--fast);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.8);
      font-family:inherit;
    }
    input::placeholder{color:rgba(109,125,150,0.7); font-weight:400;}
    input:focus, select:focus{ 
      outline:none; 
      border-color:rgba(50,120,255,0.8); 
      box-shadow:0 0 0 4px rgba(68,143,255,0.18); 
      transform:translateY(-1px); 
    }

    button{
      position:relative; width:100%; border:none; border-radius:var(--radius-md);
      padding:16px 18px; font-size:1.03rem; font-weight:700; letter-spacing:.01em; color:#fff; cursor:pointer;
      background:linear-gradient(135deg, #2967ff 0%, #25cfff 100%);
      box-shadow:0 28px 60px -32px rgba(19,95,255,0.95);
      transition:transform var(--fast), box-shadow var(--fast);
      overflow:hidden;
      font-family:inherit;
    }
    button::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(120deg, rgba(255,255,255,0.35), rgba(255,255,255,0));
      opacity:0; transition:opacity var(--fast);
    }
    button:hover{ transform:translateY(-2px) scale(1.01); }
    button:hover::after{ opacity:1; }
    button:active{ transform:scale(0.98); }
    .btn-secondary{
      background:rgba(255,255,255,0.9);
      color:var(--blue-600);
      border:1px solid rgba(160,185,255,0.55);
      box-shadow:none;
    }

    .result-box{
      display:none;
      border-radius:var(--radius-xl);
      padding:28px 22px 32px;
      text-align:center;
      background:linear-gradient(160deg, rgba(38,107,255,0.22) 0%, rgba(255,255,255,0.78) 100%);
      border:1px solid rgba(120,174,255,0.4);
      box-shadow:0 28px 58px -34px rgba(32,83,255,0.65);
      animation:scaleUp var(--slow);
      margin-bottom:120px;
    }
    @keyframes scaleUp{ from{opacity:0; transform:translateY(16px) scale(0.98);} to{opacity:1; transform:translateY(0) scale(1);} }
    .result-box .hours{ font-size:3.2rem; font-weight:800; color:var(--blue-600); margin-bottom:8px; }
    .comparison{
      margin-top:16px;
      padding:14px;
      background:rgba(255,255,255,0.6);
      border-radius:var(--radius-sm);
      font-size:0.9rem;
      color:var(--muted);
    }

    .decision-buttons{ display:flex; gap:12px; margin-top:20px; }
    .decision-buttons button{ flex:1; box-shadow:none; }
    .decision-buttons .save{ background:linear-gradient(135deg, #1fb981 0%, #36e1a9 100%); }
    .decision-buttons .buy{ background:linear-gradient(135deg, #ff5c6a 0%, #ff7f9a 100%); }

    #history-list{ display:flex; flex-direction:column; gap:16px; }
    .history-item{
      position:relative; padding:20px 22px 22px 26px; border-radius:var(--radius-md);
      background:var(--glass); backdrop-filter:blur(24px);
      border:1px solid rgba(210,222,255,0.45);
      box-shadow:0 16px 40px -32px rgba(30,50,105,0.5);
      transition:transform var(--fast), box-shadow var(--fast);
      animation:cardEnter .45s ease both;
      overflow:hidden;
    }
    .history-item::before{
      content:""; position:absolute; top:18px; left:12px; bottom:18px; width:6px; border-radius:999px;
      background:linear-gradient(180deg, rgba(53,109,255,0.8), rgba(112,200,255,0.45));
    }
    .history-item.green::before{ background:linear-gradient(180deg, rgba(32,187,130,0.9), rgba(115,236,189,0.5)); }
    .history-item.red::before{ background:linear-gradient(180deg, rgba(255,92,106,0.9), rgba(255,162,174,0.5)); }
    .history-item strong{ display:block; font-weight:700; margin-bottom:4px;}
    .history-item span{ font-weight:600; color:var(--text); }
    .history-item small{ color:var(--muted); font-size:.78rem; display:block; margin-top:6px;}
    .history-item:hover{ transform:translateY(-4px); box-shadow:0 26px 60px -34px rgba(30,54,126,0.66); }
    @keyframes cardEnter{ from{opacity:0; transform:translateY(18px);} to{opacity:1; transform:translateY(0);} }

    .achievements-grid{
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:12px;
    }
    .achievement{
      padding:18px;
      border-radius:var(--radius-md);
      background:var(--glass);
      border:1px solid var(--glass-border);
      text-align:center;
      transition:all var(--fast);
    }
    .achievement.unlocked{
      background:linear-gradient(135deg, rgba(49,214,159,0.15), rgba(255,255,255,0.75));
      border-color:rgba(49,214,159,0.4);
    }
    .achievement.locked{
      opacity:0.5;
      filter:grayscale(1);
    }
    .achievement-icon{
      font-size:32px;
      margin-bottom:8px;
    }
    .achievement-title{
      font-size:0.85rem;
      font-weight:700;
      margin-bottom:4px;
    }
    .achievement-desc{
      font-size:0.72rem;
      color:var(--muted);
    }

    .stats-grid{ display:flex; flex-direction:column; gap:20px;}
    .progress-shell{
      display:flex; flex-direction:column; align-items:center; gap:16px;
      padding:28px 24px 32px; border-radius:var(--radius-xl);
      background:var(--glass); border:1px solid rgba(210,222,255,0.45);
      box-shadow:var(--shadow-soft); backdrop-filter:blur(28px);
    }
    .progress-ring{
      --progress:0deg;
      width:168px; height:168px; border-radius:50%; position:relative;
      background:
        radial-gradient(circle at center, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.2) 58%, rgba(255,255,255,0) 65%),
        conic-gradient(from -90deg, #2b5bf7 var(--progress), rgba(235,242,255,0.6) var(--progress));
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 30px 70px -40px rgba(24,85,255,0.5);
      transition:background .6s ease;
    }
    .progress-ring::after{
      content:""; position:absolute; inset:12px; border-radius:50%; background:rgba(255,255,255,0.88); backdrop-filter:blur(16px);
    }
    #ratio{ position:relative; font-size:2.4rem; font-weight:800; color:var(--blue-600); z-index:1; }
    .pulse{ animation:pulseText .8s ease; }
    @keyframes pulseText{ 0%{transform:scale(.92); opacity:.3;} 60%{transform:scale(1.05); opacity:1;} 100%{transform:scale(1);} }

    .stats-cards{ display:flex; flex-direction:column; gap:16px; }
    .stats-card{
      border-radius:var(--radius-lg); padding:20px 22px;
      background:var(--glass-strong); border:1px solid rgba(210,222,255,0.45);
      box-shadow:0 18px 50px -34px rgba(30,60,120,0.6); backdrop-filter:blur(20px);
    }
    .stats-card strong{ font-size:1.6rem; color:var(--text); }

    .chart-container{
      height:180px;
      position:relative;
      margin-top:12px;
    }
    .chart-bars{
      display:flex;
      align-items:flex-end;
      justify-content:space-around;
      height:100%;
      gap:8px;
    }
    .chart-bar{
      flex:1;
      background:linear-gradient(180deg, var(--blue-500), var(--cyan));
      border-radius:8px 8px 0 0;
      position:relative;
      min-height:20px;
      transition:all var(--fast);
    }
    .chart-bar:hover{
      opacity:0.8;
      transform:translateY(-4px);
    }
    .chart-label{
      position:absolute;
      bottom:-24px;
      left:50%;
      transform:translateX(-50%);
      font-size:0.7rem;
      color:var(--muted);
      white-space:nowrap;
    }

    .quote-card{
      padding:24px;
      border-radius:var(--radius-xl);
      background:linear-gradient(135deg, rgba(185,104,255,0.15), rgba(255,255,255,0.85));
      border:1px solid rgba(185,104,255,0.3);
      text-align:center;
      margin-bottom:20px;
    }
    .quote-icon{
      font-size:36px;
      margin-bottom:12px;
    }
    .quote-text{
      font-size:1.05rem;
      font-weight:600;
      color:var(--text);
      font-style:italic;
    }

    nav{
      position:fixed; left:50%; bottom:36px; transform:translateX(-50%);
      width:min(100%,420px); padding:10px; border-radius:999px;
      background:rgba(255,255,255,0.30); backdrop-filter:blur(28px);
      border:1px solid rgba(255,255,255,0.6); box-shadow:var(--shadow-nav);
      display:none;
      gap:10px; z-index:20;
      pointer-events:none;
      transition:opacity var(--fast), transform var(--fast);
    }
    nav.show{
      display:flex;
    }
    nav button{
      flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;
      padding:12px; border-radius:18px; background:transparent; color:var(--muted);
      font-size:.74rem; font-weight:700; letter-spacing:.01em; transition:background var(--fast), color var(--fast), transform var(--fast);
      border:none;
      pointer-events:auto;
    }
    nav button svg{ width:22px; height:22px; fill:currentColor; transition:transform var(--fast); }
    nav button span{ font-size:.72rem; }
    nav button:hover{ transform:translateY(-2px); }
    nav button:hover svg{ transform:translateY(-1px); }
    nav button.active{
      background:linear-gradient(135deg, rgba(42,104,255,0.92), rgba(55,212,255,0.78));
      color:#fff; box-shadow:0 18px 45px -28px rgba(19,95,255,0.9);
    }
    nav button.active svg{ fill:#fff; }
    .nav-glow{
      position:absolute; inset:-18px -30px; border-radius:inherit;
      background:radial-gradient(circle at center, rgba(48,130,255,0.2), rgba(48,130,255,0));
      opacity:0; transition:opacity var(--fast); z-index:-1;
    }
    nav button.active .nav-glow{ opacity:1; }

    /* Share Widget */
    .share-widget{
      position:fixed;
      bottom:120px;
      right:20px;
      z-index:90;
      animation:slideInBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display:none;
    }
    .share-widget.show{
      display:block;
    }
    @keyframes slideInBounce{
      from{ opacity:0; transform:translateY(100px) scale(0.8); }
      to{ opacity:1; transform:translateY(0) scale(1); }
    }
    .share-bubble{
      position:relative;
      background:linear-gradient(135deg, #31d69f 0%, #28d3c0 100%);
      color:#fff;
      padding:18px 22px;
      border-radius:20px 20px 20px 4px;
      box-shadow:0 12px 40px rgba(40,211,192,0.45);
      max-width:280px;
      cursor:pointer;
      transition:all var(--fast);
    }
    .share-bubble:hover{
      transform:translateY(-3px);
      box-shadow:0 16px 50px rgba(40,211,192,0.6);
    }
    .share-bubble:active{
      transform:scale(0.98);
    }
    .share-close{
      position:absolute;
      top:-8px;
      right:-8px;
      width:24px;
      height:24px;
      border-radius:50%;
      background:rgba(255,255,255,0.95);
      color:#31d69f;
      border:none;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:16px;
      font-weight:700;
      line-height:1;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
      transition:all var(--fast);
    }
    .share-close:hover{
      transform:scale(1.1) rotate(90deg);
      background:#fff;
    }
    .share-icon{
      font-size:28px;
      margin-bottom:8px;
      animation:wave 1s ease-in-out infinite;
    }
    @keyframes wave{
      0%, 100%{ transform:rotate(0deg); }
      25%{ transform:rotate(15deg); }
      75%{ transform:rotate(-15deg); }
    }
    .share-text{
      font-size:0.95rem;
      font-weight:600;
      line-height:1.4;
    }
    .share-text small{
      display:block;
      margin-top:6px;
      font-size:0.8rem;
      opacity:0.9;
      font-weight:500;
    }

    @media(min-width:520px){ 
      nav{ bottom:46px; }
      .app-shell{ padding-bottom:300px; }
    }
    @media(max-width:520px){
      .share-widget{
        bottom:100px;
        right:16px;
      }
      .share-bubble{
        max-width:240px;
        padding:16px 18px;
      }
    }
  </style>
</head>
<body>
  <!-- Version Check Banner -->
  <div id="version-banner" class="version-banner hidden">
    <span>üéâ √öj verzi√≥ el√©rhet≈ë!</span>
    <button onclick="reloadApp()" class="version-btn">Friss√≠t√©s</button>
  </div>
  
  <div id="build-badge" style="position:fixed;left:8px;top:6px;font-size:11px;color:#5d6b85;opacity:.8;z-index:50;">v2.4 STABLE</div>

  <!-- Share Widget -->
  <div id="shareWidget" class="share-widget">
    <div class="share-bubble" onclick="handleShare()">
      <button class="share-close" onclick="closeShareWidget(event)" aria-label="Bez√°r√°s">√ó</button>
      <div class="share-icon">üöÄ</div>
      <div class="share-text">
        Oszd meg bar√°taiddal!
        <small>Kattints a megoszt√°shoz</small>
      </div>
    </div>
  </div>

  <div class="app-shell">
    <main class="screen-stack">

      <!-- 1. Welcome -->
      <section id="screen-welcome" class="screen active">
        <div class="welcome-hero">
          <div class="welcome-pill">üí∞ Sz√°molj √©s legy√©l szomor√∫!</div>
          <h1>Munka√≥ra</h1>

          <div class="hero-clock" role="img" aria-label="Alarm clock">
            <div class="clock-body">
              <div class="clock-hand hour"></div>
              <div class="clock-hand minute"></div>
            </div>
            <div class="clock-bell left"></div>
            <div class="clock-bell right"></div>
            <div class="clock-leg left"></div>
            <div class="clock-leg right"></div>
          </div>

          <p class="welcome-copy">Sz√°mold ki, mennyi munka√≥r√°dba ker√ºl egy v√°gyott v√°s√°rl√°s √©s √©rezd nagyon rosszul magad!</p>

          <!-- INVITE CARD - kezdetben l√°that√≥ -->
          <div id="inviteCard" class="card invite-card">
            <h3>üîë Megh√≠v√≥ sz√ºks√©ges</h3>
            <p class="invite-copy">Add meg az invite k√≥dodat a Munka√≥ra Pro √©lm√©ny el√©r√©s√©hez.</p>
            <div class="invite-form">
              <input id="inviteCodeInput" placeholder="Pl. 1843-5092-JKLP" autocomplete="one-time-code" inputmode="text" />
              <button type="button" onclick="validateInvite()">‚úÖ K√≥d ellen≈ërz√©se</button>
            </div>
            <div id="inviteStatus" class="invite-status" role="status" aria-live="polite"></div>
          </div>

          <!-- START CARD - kezdetben rejtett, invite ut√°n megjelenik -->
          <div id="startCard" class="card hidden" style="width:100%;">
            <div class="stack">
              <button id="startButton" type="button" onclick="startApp()">üöÄ Kezdj√ºk el!</button>
              <p style="text-align:center;font-size:0.85rem;">M√°r <strong>2,847</strong> felhaszn√°l√≥ sp√≥rolt <strong>18,392</strong> √≥r√°t! üéâ</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. Profil -->
      <section id="screen-profile" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Munka√≥ra</span>
            <h2>‚öôÔ∏è Profilod</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="T√©m√°k v√°lt√°sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M12 12.75a5.25 5.25 0 1 0-5.25-5.25A5.26 5.26 0 0 0 12 12.75Zm0 2.25c-3.486 0-7.5 1.757-7.5 4.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5c0-2.743-4.014-4.5-7.5-4.5Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div class="card stack">
            <p>Add meg az alapadataidat, hogy pontosan l√°ssuk, mennyi id≈ët dolgozol egy term√©k√©rt.</p>
            <input id="name" placeholder="üë§ N√©v" />
            <input id="age" placeholder="üéÇ √âletkor" type="number" />
            <input id="city" placeholder="üìç Telep√ºl√©s" />
            <input id="income" placeholder="üí∞ Havi nett√≥ j√∂vedelem (Ft)" type="number" />
            <input id="hours" placeholder="‚è∞ Heti munka√≥ra" type="number" />
            <button onclick="saveProfile()">üíæ Ment√©s √©s tov√°bbl√©p√©s</button>
          </div>
        </div>
      </section>

      <!-- 3. Kalkul√°tor -->
      <section id="screen-calculator" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Munka√≥ra</span>
            <h2>üßÆ Kalkul√°tor</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="T√©m√°k v√°lt√°sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M6 2.75h12A3.25 3.25 0 0 1 21.25 6v12A3.25 3.25 0 0 1 18 21.25H6A3.25 3.25 0 0 1 2.75 18V6A3.25 3.25 0 0 1 6 2.75Zm.5 4a.75.75 0 0 0 0 1.5h2a.75.75 0 0 0 0-1.5h-2Zm0 4a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Zm0 4a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div class="card">
            <div class="stack">
              <input id="product" placeholder="üè∑Ô∏è Term√©kn√©v" />
              <input id="price" placeholder="üíµ √År (Ft)" type="number" />
              <button onclick="calculate()">üîç Sz√°mol√°s</button>

              <div id="result-box" class="result-box">
                <div class="hours" id="hoursResult">0</div>
                <p style="font-size:1.1rem;font-weight:600;">munka√≥r√°dba ker√ºlne</p>
                <div class="comparison" id="comparison"></div>
                <div class="decision-buttons">
                  <button class="save" onclick="saveDecision('megsporolom')">üí™ Megsp√≥rolom</button>
                  <button class="buy" onclick="saveDecision('megveszem')">üõí Megveszem</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 4. El≈ëzm√©nyek -->
      <section id="screen-history" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Munka√≥ra</span>
            <h2>üìú El≈ëzm√©nyek</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="T√©m√°k v√°lt√°sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M12 3.75A8.25 8.25 0 1 0 20.25 12a.75.75 0 0 1 1.5 0 9.75 9.75 0 1 1-3.31-7.324l1.155-1.154a.75.75 0 1 1 1.06 1.06l-2.5 2.5a.75.75 0 0 1-1.28-.53V4.5a.75.75 0 0 1 1.5 0v1.134A8.23 8.23 0 0 0 12 3.75Zm.75 4.5v3.44l2.845 1.705a.75.75 0 0 1-.76 1.29l-3.25-1.95A.75.75 0 0 1 11.25 12V8.25a.75.75 0 0 1 1.5 0Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div id="history-list"></div>
        </div>
      </section>

      <!-- 5. Statisztik√°k -->
      <section id="screen-stats" class="screen">
        <header class="screen-header">
          <div>
            <span class="caption">Munka√≥ra</span>
            <h2>üìä Statisztik√°k</h2>
          </div>
          <div class="theme-toggle" onclick="toggleTheme()" title="T√©m√°k v√°lt√°sa">
            <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          </div>
          <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M5.75 4A1.75 1.75 0 0 1 7.5 2.25h1A1.75 1.75 0 0 1 10.25 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5 5A1.75 1.75 0 0 1 13 7.25h1A1.75 1.75 0 0 1 15.75 9v10.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5-5A1.75 1.75 0 0 1 18.5 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2V4a1.75 1.75 0 0 1 1.75-1.75h1Z"/></svg>
          </div>
        </header>
        <div class="stack">
          <div class="quote-card">
            <div class="quote-icon">üí°</div>
            <div class="quote-text" id="dailyQuote">Minden megsp√≥rolt √≥ra egy l√©p√©s a p√©nz√ºgyi szabads√°g fel√©!</div>
          </div>

          <div class="stats-grid">
            <div class="progress-shell">
              <div class="progress-ring" id="ratioCircle">
                <span id="ratio">0%</span>
              </div>
              <p style="font-weight:600;">Sp√≥rol√°si ar√°ny üéØ</p>
            </div>

            <div class="card">
              <h3>üìà Heti √∂sszes√≠t≈ë</h3>
              <div class="chart-container">
                <div class="chart-bars" id="weeklyChart"></div>
              </div>
            </div>

            <div class="stats-cards">
              <div class="stats-card">
                <p>üíö <strong id="savedHours">0</strong> √≥ra megsp√≥rolva</p>
              </div>
              <div class="stats-card">
                <p>üí∏ <strong id="spentHours">0</strong> √≥ra elk√∂ltve</p>
              </div>
              <div class="stats-card">
                <p>üèÜ <strong id="totalDecisions">0</strong> d√∂nt√©s eddig</p>
              </div>
              <div class="stats-card">
                <p>üî• <strong id="streak">0</strong> napos sorozat</p>
              </div>
            </div>

            <div class="card">
              <h3>üèÖ Eredm√©nyek</h3>
              <div class="achievements-grid" id="achievementsGrid"></div>
            </div>
          </div>

          <div class="card" style="text-align:center;">
            <button onclick="exportData()">üì• Adatok export√°l√°sa (CSV)</button>
            <button class="btn-secondary" onclick="goTo('calculator')" style="margin-top:12px;">üîô √öj kalkul√°ci√≥</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <nav id="main-nav">
    <button id="nav-calculator" onclick="goTo('calculator')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M6.75 3A2.75 2.75 0 0 0 4 5.75v12.5A2.75 2.75 0 0 0 6.75 21h10.5A2.75 2.75 0 0 0 20 18.25V5.75A2.75 2.75 0 0 0 17.25 3Zm .75 3.5h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1 0-1.5Zm0 4h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1 0-1.5Zm0 4h4a.75.75 0 0 1 0 1.5h-4a.75.75 0 0 1 0-1.5Z"/></svg>
      <span>Sz√°mol</span>
    </button>
    <button id="nav-history" onclick="goTo('history')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M12 2.75A9.25 9.25 0 1 0 21.25 12a.75.75 0 0 1 1.5 0 10.75 10.75 0 1 1-3.694-8.076l1.288-1.288a.75.75 0 0 1 1.06 1.06l-2.75 2.75a.75.75 0 0 1-1.28-.53V4.5a.75.75 0 0 1 1.5 0v.792A9.23 9.23 0 0 0 12 2.75Zm.75 5.5v3.69l3.095 1.855a.75.75 0 0 1-.75 1.29l-3.5-2.1A.75.75 0 0 1 11.25 12V8.25a.75.75 0 0 1 1.5 0Z"/></svg>
      <span>T√∂rt√©net</span>
    </button>
    <button id="nav-stats" onclick="goTo('stats')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M6.75 4A1.75 1.75 0 0 1 8.5 2.25h1A1.75 1.75 0 0 1 11.25 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5 5A1.75 1.75 0 0 1 14 7.25h1A1.75 1.75 0 0 1 16.75 9v10.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2Zm5.5-5A1.75 1.75 0 0 1 19.5 4v15.75a2 2 0 0 1-2 2h-.75a2 2 0 0 1-2-2V4a1.75 1.75 0 0 1 1.75-1.75h1Z"/></svg>
      <span>Statisztika</span>
    </button>
    <button id="nav-profile" onclick="goTo('profile')">
      <span class="nav-glow"></span>
      <svg viewBox="0 0 24 24"><path d="M12 12.75a5.25 5.25 0 1 0-5.25-5.25A5.26 5.26 0 0 0 12 12.75Zm0 2.25c-3.486 0-7.5 1.757-7.5 4.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5c0-2.743-4.014-4.5-7.5-4.5Z"/></svg>
      <span>Profil</span>
    </button>
  </nav>

  <script>
    function track(name, params = {}) {
      if (window.gtag) window.gtag('event', name, params);
    }

    let selectedCategory = 'other';

    const achievements = [
      {id:'first',title:'Els≈ë l√©p√©s',desc:'Els≈ë kalkul√°ci√≥',icon:'üéØ',condition:d=>d.history.length>=1},
      {id:'five',title:'Szorgalmas',desc:'5 d√∂nt√©s',icon:'üí™',condition:d=>d.history.length>=5},
      {id:'saver',title:'Takar√©kos',desc:'5 sp√≥rol√°s',icon:'üí∞',condition:d=>d.history.filter(i=>i.decision==='megsporolom').length>=5},
      {id:'week',title:'H√©t h≈ës',desc:'7 napos sorozat',icon:'üî•',condition:d=>calcStreak(d)>=7},
      {id:'ten',title:'Veter√°n',desc:'10 d√∂nt√©s',icon:'üèÜ',condition:d=>d.history.length>=10},
      {id:'ratio',title:'Mester',desc:'70% sp√≥rol√°s',icon:'‚≠ê',condition:d=>{const s=d.history.filter(i=>i.decision==='megsporolom').length;return d.history.length?s/d.history.length>=0.7:false;}}
    ];

    const quotes = [
      'Minden megsp√≥rolt √≥ra egy l√©p√©s a p√©nz√ºgyi szabads√°g fel√©! üí™',
      'A legjobb befektet√©s: az, amit nem k√∂lt√∂tt√©l el! üéØ',
      'Kis l√©p√©sek, nagy eredm√©nyek! üöÄ',
      'Te ir√°ny√≠tod a p√©nzedet, ne ford√≠tva! üí∞',
      'A tudatos v√°s√°rl√°s a j√∂v≈ëd kulcsa! üîë',
      'Gondolkozz hossz√∫ t√°von, √©lj boldogan! ‚ú®'
    ];

    const INVITE_CODES = [
      '1843-5092-JKLP','9320-1748-MQAE','4076-9921-BTCR','8512-3167-ZWUY','6940-2583-PXEV','7234-8119-HRLT','5802-4671-YQMN','9375-1204-VKAD','4129-7350-NBUE','6583-2901-GCFW',
      '1726-8450-RMZH','3608-5942-WTLQ','9481-6023-EXHP','5307-1849-UJNC','7824-9631-DBSO','6159-2478-FLQA','8046-5312-SKNY','2973-6581-QGJR','4510-9824-VMPC','6791-3405-LHEA',
      '5804-7912-CYTK','1639-4275-NZUF','7102-3698-XQBL','9258-6047-WTRD','3479-8516-MPAH','6903-2781-HQYE','8541-3902-JDUT','4068-1579-RWKC','7135-9804-LZMV','2486-5319-VQEA',
      '9721-3408-XGTF','1840-5726-BKUL','5603-1987-YQPR','3981-6205-MHFC','7092-4186-ZRTA','8460-2351-NPLW','6217-5093-TRXE','9748-6310-DMWQ','5039-2186-GYKH','7825-4691-QALV',
      '6358-9702-XRBD','2914-5803-VKQE','8042-7365-TLJM','1679-2058-RSHP','9380-6147-BFWN','4723-5981-HQCT','6598-3402-YZUR','3251-4790-MWJE','5906-8217-KDPL','7439-1062-XBVR'
    ];
    const INVITE_QUEUE_KEY = 'munkaora_invite_queue';
    const INVITE_VALID_KEY = 'munkaora_invite_valid';
    let inviteQueue = [];
    let inviteValidated = false;

    function normalizeInviteCode(value){
      return String(value || '').toUpperCase().replace(/[^A-Z0-9]/g, '');
    }

    function loadInviteQueue(){
      try{
        const stored = JSON.parse(localStorage.getItem(INVITE_QUEUE_KEY));
        if(Array.isArray(stored)){
          const sanitized = stored.filter(code => INVITE_CODES.includes(code));
          const missing = INVITE_CODES.filter(code => !sanitized.includes(code));
          return sanitized.concat(missing);
        }
      }catch(e){ }
      return [...INVITE_CODES];
    }

    function persistInviteQueue(){
      localStorage.setItem(INVITE_QUEUE_KEY, JSON.stringify(inviteQueue));
    }

    function updateInviteStatus(message, status = 'info'){
      const statusEl = document.getElementById('inviteStatus');
      if(!statusEl) return;
      statusEl.textContent = message;
      statusEl.setAttribute('data-status', status);
    }

    function showStartCard(){
      document.getElementById('inviteCard').classList.add('hidden');
      document.getElementById('startCard').classList.remove('hidden');
    }

    function hideStartCard(){
      document.getElementById('inviteCard').classList.remove('hidden');
      document.getElementById('startCard').classList.add('hidden');
    }

    function initInviteGate(){
      inviteQueue = loadInviteQueue();
      inviteValidated = localStorage.getItem(INVITE_VALID_KEY) === 'true';
      const input = document.getElementById('inviteCodeInput');
      if(input){
        input.addEventListener('keydown', (event) => {
          if(event.key === 'Enter'){
            event.preventDefault();
            validateInvite();
          }
        });
      }
      if(inviteValidated){
        showStartCard();
      } else {
        hideStartCard();
        updateInviteStatus('Add meg az invite k√≥dodat a kezd√©shez.', 'info');
      }
    }

    function validateInvite(){
      const input = document.getElementById('inviteCodeInput');
      if(!input) return;
      const code = normalizeInviteCode(input.value);
      if(!code){
        updateInviteStatus('√çrj be egy megh√≠v√≥ k√≥dot!', 'error');
        inviteValidated = false;
        localStorage.removeItem(INVITE_VALID_KEY);
        hideStartCard();
        return;
      }
      const index = inviteQueue.findIndex(item => normalizeInviteCode(item) === code);
      if(index === -1){
        updateInviteStatus('‚ùå Ez a megh√≠v√≥ k√≥d nem √©rv√©nyes.', 'error');
        inviteValidated = false;
        localStorage.removeItem(INVITE_VALID_KEY);
        hideStartCard();
        return;
      }
      const [matched] = inviteQueue.splice(index, 1);
      inviteQueue.push(matched);
      persistInviteQueue();
      inviteValidated = true;
      localStorage.setItem(INVITE_VALID_KEY, 'true');
      input.value = '';
      showStartCard();
      track('invite_validated');
    }

    function startApp(){
      if(!inviteValidated){
        updateInviteStatus('Add meg az √©rv√©nyes megh√≠v√≥ k√≥dot a kezd√©shez.', 'error');
        hideStartCard();
        return;
      }
      track('start_click');
      goTo('profile');
    }

    function toggleTheme(){
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      html.setAttribute('data-theme', current === 'dark' ? '' : 'dark');
      track('theme_toggle', {theme: current === 'dark' ? 'light' : 'dark'});
    }

    function goTo(screen) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(`screen-${screen}`).classList.add('active');
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      const nb = document.getElementById(`nav-${screen}`);
      if (nb) nb.classList.add('active');
      
      const nav = document.getElementById('main-nav');
      if(screen === 'welcome'){
        nav.classList.remove('show');
      } else {
        nav.classList.add('show');
      }
      
      track('view_' + screen);
      if (screen === 'history') loadHistory();
      if (screen === 'stats') loadStats();
    }

    const STORE_KEY = 'munkaora_data';
    function loadData(){
      try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || { profile:{}, history:[] }; }
      catch(e){ return { profile:{}, history:[] }; }
    }
    function saveData(data){ localStorage.setItem(STORE_KEY, JSON.stringify(data)); }

    function saveProfile(){
      const data = loadData();
      data.profile = {
        name: document.getElementById('name').value,
        age: +document.getElementById('age').value,
        city: document.getElementById('city').value,
        income: +document.getElementById('income').value,
        hoursPerWeek: +document.getElementById('hours').value
      };
      saveData(data);
      track('profile_saved');
      goTo('calculator');
    }

    let currentProduct = null;
    let currentPrice = 0;
    let currentHours = 0;

    function calculate(){
      const data = loadData();
      const p = data.profile;
      if(!p.income || !p.hoursPerWeek){
        alert('El≈ëbb add meg a profilod adataid!');
        goTo('profile');
        return;
      }
      const product = document.getElementById('product').value.trim();
      const price = +document.getElementById('price').value;
      if(!product || !price){
        alert('Add meg a term√©k nev√©t √©s √°r√°t!');
        return;
      }
      
      const hourly = p.income / (p.hoursPerWeek * 4);
      const hours = (price / hourly).toFixed(1);
      
      const comparisons = [
        `Ez ${Math.round(hours/8)} munkanap! üìÖ`,
        `Ennyi id≈ë alatt ${Math.round(hours*60/90)} filmet n√©zhetn√©l! üé¨`,
        `Vagy ${Math.round(hours)} √≥ra olvas√°s k√∂nyvekkel! üìö`,
        `${Math.round(hours*60/30)} Netflix epiz√≥d! üì∫`
      ];
      
      document.getElementById('result-box').style.display = 'block';
      document.getElementById('hoursResult').innerText = hours;
      document.getElementById('comparison').innerText = comparisons[Math.floor(Math.random()*comparisons.length)];
      currentProduct = product;
      currentPrice = price;
      currentHours = hours;
      track('calculation_done', { product, price, category: selectedCategory });
    }

    function saveDecision(type){
      if(!currentProduct){ alert('El≈ëbb sz√°moljunk!'); return; }
      const data = loadData();
      data.history.push({
        id: Date.now(),
        product: currentProduct,
        price: currentPrice,
        hours: currentHours,
        decision: type,
        category: selectedCategory,
        ts: new Date().toISOString()
      });
      saveData(data);
      track('decision_click', { decision: type, product: currentProduct, price: currentPrice });
      document.getElementById('result-box').style.display = 'none';
      document.getElementById('product').value = '';
      document.getElementById('price').value = '';
      selectedCategory = 'other';
      goTo('history');
    }

    function loadHistory(){
      const list = document.getElementById('history-list');
      list.innerHTML = '';
      const data = loadData();
      if(data.history.length === 0){
        list.innerHTML = '<div class="card" style="text-align:center;"><p>üì≠ M√©g nincs adatod.</p><button class="btn-secondary" onclick="goTo(\'calculator\')">üöÄ Ind√≠ts kalkul√°ci√≥t</button></div>';
        track('history_empty_view');
        return;
      }
      [...data.history].reverse().forEach(item=>{
        const el = document.createElement('div');
        el.className = 'history-item ' + (item.decision === 'megsporolom' ? 'green' : 'red');
        el.innerHTML =
          '<strong>' + escapeHtml(item.product) + '</strong>' +
          '<span>' + Number(item.price).toLocaleString('hu-HU') + ' Ft</span><br>' +
          '<small>' + item.hours + ' √≥ra ‚Ä¢ ' + new Date(item.ts).toLocaleDateString('hu-HU') + '</small>';
        list.appendChild(el);
      });
      track('history_loaded', { count: data.history.length });
    }

    function calcStreak(data){
      if(!data.history.length)return 0;
      const sorted = [...data.history].sort((a,b)=>new Date(b.ts)-new Date(a.ts));
      let streak=1;
      for(let i=1;i<sorted.length;i++){
        const d1=new Date(sorted[i-1].ts).toDateString();
        const d2=new Date(sorted[i].ts).toDateString();
        const diff = (new Date(d1)-new Date(d2))/(1000*60*60*24);
        if(diff<=1)streak++;
        else break;
      }
      return streak;
    }

    function loadStats(){
      const data = loadData();
      const saved = data.history.filter(i => i.decision === 'megsporolom');
      const spent = data.history.filter(i => i.decision === 'megveszem');
      const total = data.history.length;
      const ratio = total ? Math.round((saved.length / total) * 100) : 0;
      
      const ratioEl = document.getElementById('ratio');
      ratioEl.innerText = ratio + '%';
      ratioEl.classList.remove('pulse'); 
      void ratioEl.offsetWidth; 
      ratioEl.classList.add('pulse');
      
      const ratioCircle = document.getElementById('ratioCircle');
      if(ratioCircle){ ratioCircle.style.setProperty('--progress', (ratio * 3.6) + 'deg'); }
      
      const savedHours = saved.reduce((sum,i)=> sum + Number(i.hours), 0);
      const spentHours = spent.reduce((sum,i)=> sum + Number(i.hours), 0);
      const streak = calcStreak(data);
      
      document.getElementById('savedHours').innerText = savedHours.toFixed(1);
      document.getElementById('spentHours').innerText = spentHours.toFixed(1);
      document.getElementById('totalDecisions').innerText = total;
      document.getElementById('streak').innerText = streak;
      document.getElementById('dailyQuote').innerText = quotes[Math.floor(Math.random()*quotes.length)];
      
      const weeklyChart = document.getElementById('weeklyChart');
      weeklyChart.innerHTML = '';
      const days = ['H','K','Sze','Cs','P','Szo','V'];
      const now = new Date();
      const dayCounts = [];
      
      for(let i=6;i>=0;i--){
        const d = new Date(now);
        d.setDate(d.getDate() - i);
        const dayStr = d.toDateString();
        const count = data.history.filter(item => new Date(item.ts).toDateString() === dayStr).length;
        dayCounts.push(count);
      }
      
      const maxCount = Math.max(...dayCounts, 1);
      dayCounts.forEach((count, idx) => {
        const bar = document.createElement('div');
        bar.className = 'chart-bar';
        bar.style.height = `${(count / maxCount) * 100}%`;
        bar.innerHTML = `<div class="chart-label">${days[idx]}</div>`;
        bar.title = `${count} d√∂nt√©s`;
        weeklyChart.appendChild(bar);
      });

      const grid = document.getElementById('achievementsGrid');
      grid.innerHTML = '';
      achievements.forEach(ach => {
        const unlocked = ach.condition(data);
        const div = document.createElement('div');
        div.className = `achievement ${unlocked ? 'unlocked' : 'locked'}`;
        div.innerHTML = `
          <div class="achievement-icon">${ach.icon}</div>
          <div class="achievement-title">${ach.title}</div>
          <div class="achievement-desc">${ach.desc}</div>
        `;
        grid.appendChild(div);
      });
      
      track('stats_loaded', { total, ratio, savedHours, spentHours, streak });
    }

    function exportData(){
      const data = loadData();
      if(!data.history.length){
        alert('Nincs export√°lhat√≥ adat!');
        return;
      }
      let csv = 'D√°tum,Term√©k,√År,√ìra,D√∂nt√©s,Kateg√≥ria\n';
      data.history.forEach(i => {
        csv += `${new Date(i.ts).toLocaleString('hu-HU')},"${i.product}",${i.price},${i.hours},${i.decision},${i.category}\n`;
      });
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `munkaora_export_${new Date().toISOString().slice(0,10)}.csv`;
      link.click();
      track('data_exported');
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    // Share Widget Functions
    const SHARE_WIDGET_KEY = 'munkaora_share_widget_dismissed';
    const APP_URL = 'https://doomspending.vercel.app/';
    const SHARE_MESSAGE = 'Ez az app leford√≠tja az √°rakat id≈ëre. N√©zd meg!';

    function initShareWidget(){
      // Csak akkor jelenik meg, ha m√©g nem volt bez√°rva ebben a sessionben
      const dismissed = sessionStorage.getItem(SHARE_WIDGET_KEY);
      if(!dismissed && inviteValidated){
        // 15 m√°sodperc k√©sleltet√©s
        setTimeout(() => {
          const widget = document.getElementById('shareWidget');
          if(widget && !sessionStorage.getItem(SHARE_WIDGET_KEY)){
            widget.classList.add('show');
            track('share_widget_shown');
          }
        }, 15000);
      }
    }

    function closeShareWidget(event){
      event.stopPropagation();
      const widget = document.getElementById('shareWidget');
      if(widget){
        widget.classList.remove('show');
        sessionStorage.setItem(SHARE_WIDGET_KEY, 'true');
        track('share_widget_dismissed');
      }
    }

    async function handleShare(){
      const shareText = `${SHARE_MESSAGE}\n\n${APP_URL}`;
      
      // M√°sol√°s v√°g√≥lapra
      try {
        await navigator.clipboard.writeText(shareText);
        track('share_clipboard_success');
        
        // Vizu√°lis feedback
        const bubble = document.querySelector('.share-bubble');
        const originalText = bubble.innerHTML;
        bubble.innerHTML = `
          <div class="share-icon">‚úÖ</div>
          <div class="share-text">
            Link m√°solva!
            <small>Illeszd be b√°rhova</small>
          </div>
        `;
        
        setTimeout(() => {
          bubble.innerHTML = originalText;
        }, 2000);
      } catch(err) {
        console.error('Clipboard error:', err);
      }

      // Web Share API (f≈ëleg mobilon m≈±k√∂dik)
      if(navigator.share){
        try {
          await navigator.share({
            title: 'Munka√≥ra App',
            text: SHARE_MESSAGE,
            url: APP_URL
          });
          track('share_native_success');
        } catch(err) {
          if(err.name !== 'AbortError'){
            console.error('Share error:', err);
          }
        }
      }
    }

    (function init(){
      const d = loadData();
      if(d.profile){
        document.getElementById('name').value = d.profile.name || '';
        document.getElementById('age').value = d.profile.age || '';
        document.getElementById('city').value = d.profile.city || '';
        document.getElementById('income').value = d.profile.income || '';
        document.getElementById('hours').value = d.profile.hoursPerWeek || '';
      }
      initInviteGate();
      initShareWidget();
      checkVersion();
    })();

    // Version Check System
    const CURRENT_VERSION = 'v2.4';
    const VERSION_KEY = 'munkaora_version';

    function checkVersion(){
      try{
        const lastVersion = localStorage.getItem(VERSION_KEY);
        if(lastVersion && lastVersion !== CURRENT_VERSION){
          // Van √∫j verzi√≥!
          document.getElementById('version-banner').classList.remove('hidden');
          track('new_version_available', { from: lastVersion, to: CURRENT_VERSION });
        } else if(!lastVersion){
          // Els≈ë ind√≠t√°s, mentsd el a verzi√≥t
          localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
        }
      }catch(e){
        console.error('Version check failed:', e);
      }
    }

    function reloadApp(){
      localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
      track('version_updated', { version: CURRENT_VERSION });
      window.location.reload();
    }
  </script>
</body>
</html>
